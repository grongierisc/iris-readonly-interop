/// ReadOnly Setup Utility
Class ReadOnly.Setup Extends %Projection.AbstractProjection
{

/// Projection to make install on compile
Projection ProjectionName As Setup;

/// Call of the projection
ClassMethod CreateProjection(cls As %String, ByRef params) As %Status
{
    Return ..Install()
}

/// Installer
ClassMethod Install(path) As %Status
{
    // Create a tmp file with XData content in it
    set tFileName=##class(%File).TempFilename("xml")
    set tFile = ##class(%Stream.FileBinary).%New()
    set tFile.Filename = tFileName 
    // Read the xdata
    Set xdataID="ReadOnly.Setup||ReadOnlyInterop"
    Set compiledXdata=##class(%Dictionary.CompiledXData).%OpenId(xdataID)
    Set tStream=compiledXdata.Data
    // Copy Xdata to file
    do tFile.CopyFromAndSave(tStream)

    // Install Roles
    new $Namespace
	  set ns = $Namespace // ought to be package home namespace!
    try {
        set $Namespace = "%SYS"
        set sc = ##class(Security.Roles).Import(tFileName)
    } catch (e) {
        set mes = "<PROTECT> The user " _ $Username _ " has no privileges"
            _ " to enter the %SYS namespace. Please, log in as a privileged user"
            _ " to set up the WebTerminal application."
        set sc = $$$ERROR($$$GeneralError, mes)
    }

    Return sc
}

/// Description
XData ReadOnlyInterop
{
<?xml version="1.0" encoding="UTF-8"?>
<RolesExport>
  <Roles>
    <Description>Interoperability Operator</Description>
    <Name>#Ready_Only_Interop</Name>
    <Resources>
      <Resource>
        <Name>%Ens_Agents</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_AlertAdministration</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Alerts</Name>
        <Permission>3</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ArchiveManager</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_BPL</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_BusinessRules</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Code</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ConfigItemRun</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Credentials</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_DTL</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_DTLTest</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Dashboard</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Deploy</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_DeploymentPkg</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_DeploymentPkgClient</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_EDISchema</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_EDISchemaAnnotations</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_EventLog</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ITK</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_JBH</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Jobs</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_LookupTables</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageContent</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageDiscard</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageEditResend</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageExport</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageHeader</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageResend</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageResubmit</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageSuspend</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageTrace</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBankConfig</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_Dashboard</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_EventLog</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageContent</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageEditResend</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageHeader</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageResend</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageTrace</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_PortSettingsReport</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Portal</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ProductionConfig</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ProductionDocumentation</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ProductionRun</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_PubSub</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Purge</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_PurgeSchedule</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_PurgeSettings</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Queues</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_RecordMap</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_RestrictedUI_SystemDefaultSettings</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_RoutingRules</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_RuleLog</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Rules</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SequenceManager</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SettingsReportConfig</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultConfig</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultSettings_AllowedIPAddresses</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultSettings_IPAddress</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultSettings_Port</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultSettings_Server</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_TestingService</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ViewFileSystem</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_WorkflowConfig</Name>
        <Permission>1</Permission>
      </Resource>
    </Resources>
  </Roles>
  <Roles>
    <Description>Interoperability Operator</Description>
    <Name>#Ready_Only_Interop</Name>
    <Resources>
      <Resource>
        <Name>%Ens_Agents</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_AlertAdministration</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Alerts</Name>
        <Permission>3</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ArchiveManager</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_BPL</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_BusinessRules</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Code</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ConfigItemRun</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Credentials</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_DTL</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_DTLTest</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Dashboard</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Deploy</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_DeploymentPkg</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_DeploymentPkgClient</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_EDISchema</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_EDISchemaAnnotations</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_EventLog</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ITK</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_JBH</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Jobs</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_LookupTables</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageContent</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageDiscard</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageEditResend</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageExport</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageHeader</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageResend</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageResubmit</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageSuspend</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MessageTrace</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBankConfig</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_Dashboard</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_EventLog</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageContent</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageEditResend</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageHeader</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageResend</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_MsgBank_MessageTrace</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_PortSettingsReport</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Portal</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ProductionConfig</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ProductionDocumentation</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ProductionRun</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_PubSub</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Purge</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_PurgeSchedule</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_PurgeSettings</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Queues</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_RecordMap</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_RestrictedUI_SystemDefaultSettings</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_RoutingRules</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_RuleLog</Name>
        <Permission>4</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_Rules</Name>
        <Permission>5</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SequenceManager</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SettingsReportConfig</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultConfig</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultSettings_AllowedIPAddresses</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultSettings_IPAddress</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultSettings_Port</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_SystemDefaultSettings_Server</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_TestingService</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_ViewFileSystem</Name>
        <Permission>1</Permission>
      </Resource>
      <Resource>
        <Name>%Ens_WorkflowConfig</Name>
        <Permission>1</Permission>
      </Resource>
    </Resources>
  </Roles>
</RolesExport>
}

}
